environments:
  - name: acceptance
    loadbalancer:
      hostedzone: ecogytest.io
      name: bpm
    cluster:
      desiredCapacity: 1
      maxSize: 1
  - name: production
    loadbalancer:
      hostedzone: ecogytest.io
      name: bpm
    cluster:
      desiredCapacity: 1
      maxSize: 1

service:
  name: ecogy-camunda-bpm
  port: 8080
  healthEndpoint: /
  pathPatterns:
    - /*
  pipeline:
    source:
      repo: ecogyenergy/docker-camunda-bpm-platform

  # Pass DB config as environment variables
  environment:
    DB_USERNAME: ${DatabaseMasterUsername}
    DB_PASSWORD: ${DatabaseMasterPassword}
    DB_URL: jdbc:mysql://${DatabaseEndpointAddress}:${DatabaseEndpointPort}/${DatabaseName}
    DB_DRIVER: org.postgresql.Driver

  # Define the database
  database:
    name: ecogy-camunda-db # Name of database to create on RDS instance

    ## The following configs are the defaults if no `environmentConfig` is defined
    engine: postgres # RDS engine to use (default: aurora)
    engineVersion: 10.4
    instanceClass: db.t2.micro # Instance class (default: db.t2.small)
    iamAuthentication: true # Enable IAM authentication (default: false)
    masterUsername: admin # RDS master username (default: admin)
    allocatedStorage: 100 # Storage requirement (in GB) (default: none)
    engineMode: provisioned # RDS engine mode: provisioned or serverless (default: provisioned)
    minSize: 2 # Minimum ACU for auto scaling (default: 2)
    maxSize: 16 # Maximum ACU for auto scaling (default: 256)
    # kmsKey: arn:aws:kms:us-east-1:061911147985:key/8e1c7297-9eaa-4ed4-97bf-c27d9cc6a3ec # The ARN of the KMS key to use for the database

    # Configuration per environment, override any of the configs above
    environmentConfig:
      acceptance:
        engineMode: serverless # RDS engine mode: provisioned or serverless (default: provisioned)
        minSize: 2 # Minimum ACU for auto scaling (default: 2)
        maxSize: 2 # Maximum ACU for auto scaling (default: 256)
      production:
        engineMode: provisioned # RDS engine mode: provisioned or serverless (default: provisioned)
        minSize: 8 # Minimum ACU for auto scaling (default: 2)
        maxSize: 64 # Maximum ACU for auto scaling (default: 256)
